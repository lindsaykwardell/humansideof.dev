---
import DefaultLayout from "@/layouts/DefaultLayout.astro";
import Episode from "@/components/Episode.astro";
import Lindsay from "@/components/Lindsay.astro";
import { getEpisodes } from "@/api/rss";
import { getCollection } from "astro:content";
import BlogPostCard from "@/components/BlogPostCard.astro";
import ConvertKit from "@/components/ConvertKit.astro";

const { entries } = await getEpisodes();
const posts = await getCollection(
  "blog",
  (post) => post.data.published === true || import.meta.env.DEV
);

const episodesOnHomePage = 3;

const latestPodcasts = entries.slice(0, episodesOnHomePage);
const latestPosts = posts.slice(0, episodesOnHomePage);
---

<DefaultLayout>
  <Lindsay />
  <hr class="my-4 w-11/12 mx-auto" />
  <h2 class="font-josefin text-3xl text-center">Latest Episodes</h2>
  {
    latestPodcasts?.map((episode: any) => (
      <Episode episode={episode} showSummary={false} />
    ))
  }
  <hr class="my-4 w-11/12 mx-auto" />
  <h2 class="font-josefin text-3xl text-center">Latest Posts</h2>
  <ul class="flex flex-col gap-4 pt-8">
    {latestPosts?.map((post) => <BlogPostCard post={post} />)}
  </ul>
  <ConvertKit />
</DefaultLayout>
